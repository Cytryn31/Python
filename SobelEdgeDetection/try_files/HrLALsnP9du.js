/*1366952758,173213487*/

if (self.CavalryLogger) { CavalryLogger.start_js(["GFTc4"]); }

__d("CanvasAppRequestUpdater",["Arbiter","CSS","ChannelConstants","DOM","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('ChannelConstants'),j=b('DOM'),k=b('copyProperties'),l=b('csx');function m(n){this._root=n;g.subscribe(i.getArbiterType('app_request_create'),function(o,p){var q=j.scry(this._root,".item_"+p.obj.appid)[0],r=q&&j.scry(q,"._1k71")[0];r&&j.appendContent(r,p.obj.request);q&&this._updateBookmark(q,1);}.bind(this));g.subscribe(i.getArbiterType('app_request_delete'),function(o,p){var q=j.scry(this._root,".item_"+p.obj.appid)[0],r=q&&j.scry(q,"[data-requestid='"+p.obj.requestid+"']")[0];r&&j.remove(r.parentElement);q&&this._updateBookmark(q,-1);}.bind(this));}k(m.prototype,{_updateBookmark:function(n,o){var p=j.find(n,"._1k72"),q=j.find(n,'.countValue'),r=parseInt(j.getText(q),10),s=Math.max(0,r+o);j.setContent(q,s);if(s<1){h.hide(q.parentElement);h.hide(p);}else{h.show(q.parentElement);h.show(p);}}});e.exports=m;});
__d("CanvasFlyoutLoader",["AsyncRequest","Event","shield"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Event'),i=b('shield'),j={endpoint:'/ajax/canvas/flyouts',init:function(k,l,m){this.root=k;this.largeApps=l;this.seeAllApps=m;this.handler=h.listen(k,'mouseenter',i(this.loadFlyouts,this));},loadFlyouts:function(){this.handler.remove();this.handler=null;var k={items:this.largeApps,all_apps:this.seeAllApps};new g().setURI(this.endpoint).setRelativeTo(this.root).setMethod('post').setReadOnly(true).setData(k).setAllowCrossPageTransition(true).send();}};e.exports=j;});
__d("CanvasRecommendationFlyoutLoader",["AsyncRequest","Event","shield"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Event'),i=b('shield'),j={endpoint:'/ajax/canvas/recommendation/flyouts',init:function(k,l){this.root=k;this.apps=l;this.handler=h.listen(k,'mouseenter',i(this.loadFlyouts,this));},loadFlyouts:function(){this.handler.remove();this.handler=null;var k={items:this.apps};new g().setURI(this.endpoint).setRelativeTo(this.root).setMethod('post').setReadOnly(true).setData(k).setAllowCrossPageTransition(true).send();}};e.exports=j;});
__d("BuddyListNub",["Event","Arbiter","AvailableList","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatConfig","ChatVisibility","Class","CSS","Dock","DOM","HTML","Keys","NubController","OrderedFriendsList","PresencePrivacy","Toggler","copyProperties","csx","cx","ge","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AvailableList'),j=b('BlackbirdUpsell'),k=b('ChannelConnection'),l=b('ChannelConstants'),m=b('ChatConfig'),n=b('ChatVisibility'),o=b('Class'),p=b('CSS'),q=b('Dock'),r=b('DOM'),s=b('HTML'),t=b('Keys'),u=b('NubController'),v=b('OrderedFriendsList'),w=b('PresencePrivacy'),x=b('Toggler'),y=b('copyProperties'),z=b('csx'),aa=b('cx'),ba=b('ge'),ca=b('tx'),da=32,ea=10;function fa(ga,ha,ia){this.parent.construct(this);this.parent.init(ga);this.root=ga;this.orderedList=ha;this.typeahead=ia;this.button=r.find(ga,'a.fbNubButton');this.label=r.find(ga,'span.label');this.body=r.scry(ga,'div.fbNubFlyoutBody')[0];var ja=r.find(ga,'div.fbNubFlyoutTitlebar');x.createInstance(ja).setSticky(false);ha.subscribe('render',this.flyoutContentChanged.bind(this));ha.setScrollContainer(this.body);i.subscribe('buddylist/availability-changed',this._updateCount.bind(this));h.subscribe('chat/connect',this._handleConnect.bind(this));w.subscribe('privacy-user-presence-changed',this._handleVisibilityChange.bind(this));this.message=r.find(ga,"div._4mq1");this.warningMsgText=null;this.warningMsgEventListener=null;this.showWarningTimeout=null;k.subscribe(k.CONNECTED,this._handleChannelConnected.bind(this));k.subscribe(k.SHUTDOWN,this._handleChannelShutdown.bind(this));k.subscribe(k.RECONNECTING,this._handleChannelReconnecting.bind(this));k.subscribe([k.MUTE_WARNING,k.UNMUTE_WARNING],this._updateView.bind(this));this.subscribe('show',this.onShow.bind(this));this.subscribe('hide',this.onHide.bind(this));this.subscribe('resize',this.onResize.bind(this));g.listen(ga,'keydown',this._onKeyDown.bind(this));g.listen(this.button,'click',this.onButtonClick.bind(this));ia.subscribe(['respond','reset'],function(ka,la){if(this._isOpen){var ma=this.orderedList.isVisible();if(la&&la.value&&la.value===ia.getCore().getValue()&&ia.getView().isVisible()){q.setUseMaxHeight(this.root,false);this.orderedList.hide();}else this._showBuddyList();if(ma!==this.orderedList.isVisible())this.flyoutContentChanged();}}.bind(this));h.subscribe('sidebar/show',this.hide.bind(this));this._orderedListCount=v.getList().length;h.inform('buddylist-nub/initialized',this,h.BEHAVIOR_PERSISTENT);this._handleVisibilityChange();}o.extend(fa,u);y(fa.prototype,{getButton:function(){return this.button;},getRoot:function(){return this.root;},_handleConnect:function(ga){this._updateView(true);},_getShutdownReason:function(ga){switch(ga){case l.HINT_AUTH:return "Your session has timed out. Please log in.";case l.HINT_CONN:return ca._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});case l.HINT_MAINT:return ca._("Facebook {Chat} is currently down for maintenance.",{Chat:"Chat"});default:return ca._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});}},_getReconnectMsg:function(ga){var ha;if(ga===null){ha="Unable to connect to chat. Check your Internet connection.";}else if(ga>m.get('warning_countdown_threshold_msec')){var ia=r.create('a',{href:'#',className:'fbChatReconnectLink'},"Try again"),ja=r.create('div',null,ia),ka=ja.innerHTML;ha=s(ca._("Unable to connect to chat. {try-again-link}",{'try-again-link':ka}));}else if(ga>1000){ha=ca._("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(ga/1000)});}else ha="Unable to connect to chat. Reconnecting...";return ha;},_resetShowWarningTimeout:function(){if(this.showWarningTimeout){clearTimeout(this.showWarningTimeout);this.showWarningTimeout=null;}},_handleChannelConnected:function(ga){this._resetShowWarningTimeout();if(this.orderedList.isVisible())n.goOnline();this.warningMsgText=null;this._updateView();},_handleChannelShutdown:function(ga,ha){this._resetShowWarningTimeout();this.warningMsgText=this._getShutdownReason(ha);this._updateView();},_handleChannelReconnecting:function(ga,ha){this._resetShowWarningTimeout();this.warningMsgText=this._getReconnectMsg(ha);if(ha>1000){if(ha>m.get('warning_countdown_threshold_msec')){if(this.warningMsgEventListener){this.warningMsgEventListener.remove();this.warningMsgEventListener=null;}this.warningMsgEventListener=g.listen(this.message,'click',function(event){if(p.hasClass(event.getTarget(),'fbChatReconnectLink')){this._tryReconnect();event.kill();}}.bind(this));}this.showWarningTimeout=setTimeout(this._handleChannelReconnecting.bind(this,ga,ha-1000),1000,false);}this._updateView();},_tryReconnect:function(){if(k.disconnected())k.reconnect();},_handleVisibilityChange:function(){this._updateView();if(j.shouldShow()){if(n.hasBlackbirdEnabled()){j.showBlackbirdDialog(this.getButton(),w.getVisibility());}else if(!n.isOnline())j.showOfflineDialog(this.getButton());}else j.hide();if(!n.isOnline())this.hide();},_updateView:function(ga){var ha=ba('fbDockChat');if(ha){p.conditionClass(ha,'offline',!n.isOnline());p.conditionClass(ha,'error',k.disconnected());}if(k.disconnected())r.setContent(this.message,this.warningMsgText);if(!n.isOnline()){this._setLabel(ca._("{Chat} (Off)",{Chat:"Chat"}));}else if(k.disconnected()){this._setLabel(ca._("{Chat} (Disconnected)",{Chat:"Chat"}));}else{var ia=i.getOnlineCount();if(ia){var ja=ca._("{Chat} {number-available}",{Chat:"Chat",'number-available':['<span class="count">','(<strong>',ia,'</strong>)','</span>'].join('')});this._setLabel(s(ja));}else this._setLabel("Chat",ga);}},onButtonClick:function(){this._conditionallyShowTypeahead();if(p.shown(this.typeahead.getElement())){var ga=this.subscribe('show',function(){this.typeahead.getCore().getElement().focus();j.dismiss();}.bind(this));this.unsubscribe.bind(this,ga).defer();}},onHide:function(){this._isOpen=false;if(this._buddyListRenderSubscription){this.orderedList.unsubscribe(this._buddyListRenderSubscription);this._buddyListRenderSubscription=null;}this.orderedList.hide();this.typeahead.getCore().reset();},_onKeyDown:function(event){var ga=g.getKeyCode(event);if(ga===t.ESC&&!p.hasClass(this.root,'menuOpened')){this.hide();return false;}},onResize:function(){var ga=q.getMaxFlyoutHeight(this.root)-60,ha=Math.max(250,ga);this.orderedList.setNumTopFriends(Math.floor(ha/da));},_showBuddyList:function(){if(!this._buddyListRenderSubscription)this._buddyListRenderSubscription=this.orderedList.subscribe('render',q.setUseMaxHeight.bind(q,this.root,false));this.orderedList.show();},onShow:function(){this._isOpen=true;if(k.disconnected()){this._tryReconnect();this._showBuddyList();}else n.goOnline(this._showBuddyList.bind(this));},_setLabel:function(ga,ha){var ia=this.label.cloneNode(true);r.setContent(ia,ga);r.replace(this.label,ia);this.label=ia;this.throbber&&p.conditionShow(this.throbber,!!ha);},_conditionallyShowTypeahead:function(){p.conditionShow(this.typeahead.getElement(),this._orderedListCount>=ea);},_updateCount:function(){this._updateView();this._conditionallyShowTypeahead();}});e.exports=fa;});
__d("LiveBarData",["function-extensions","Arbiter","ArbiterMixin","AsyncRequest","ChannelConstants","LayerDestroyOnHide","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('LayerDestroyOnHide'),l=b('copyProperties'),m=b('setTimeoutAcrossTransitions'),n=false,o={},p={},q={};function r(y){if((y.expires*1000)-Date.now()>0)return true;return false;}function s(y){var z=y.payload.actions;if(!(z&&z.length))return;var aa;for(var ba=0;ba<z.length;ba++){aa=z[ba].actor_id;if(!o[aa]||z[ba].action_id!=o[aa].action_id)continue;if(z[ba].delete_action||z[ba].remove){v(z[ba]);continue;}}}function t(y){var z=false;for(var aa=0;aa<y.length;aa++){if(y[aa].delete_action||y[aa].remove){v(y[aa]);continue;}var ba=y[aa].actor_id,ca=y[aa].action_id;if(o[ba]){if(o[ba].action_id==ca)continue;v(o[ba]);}z=true;o[ba]=y[aa];u(y[aa]);}if(z)x.inform('new-actions');}function u(y){var z=(y.expires*1000)-Date.now();p[y.actor_id]=m(v.curry(y),Math.max(0,z));}function v(y){if(!o[y.actor_id])return;if(o[y.actor_id].action_id!=y.action_id)return;delete o[y.actor_id];var z=y.actor_id;if(p[z]){clearTimeout(p[z]);delete p[z];}w(z);x.inform('remove-action',y);}function w(y){var z=q[y];if(z){z.enableBehavior(k);if(!z.isShown())z.destroy();delete q[y];}}g.subscribe(j.getArbiterType('livebar_update'),function(y,z){t(z.obj.actions);});var x={};l(x,h,{fetch:function(){if(n)return;var y=[];for(var z in o){var aa=o[z];if(aa.suppress_callout)continue;if(!q[aa.actor_id])y.push(o[z]);}if(y.length>0){n=true;new i().setURI('/ajax/chat/livebar.php').setData({actions:y}).setHandler(s).setFinallyHandler(function(){n=false;}).setAllowCrossPageTransition(true).send();}},addActions:t,getAction:function(y){var z=o[y];if(z&&r(z))return z;return null;},getDialog:function(y){var z=this.getAction(y);if(z&&q[z.actor_id])return q[z.actor_id];return null;},setDialog:function(y,z,aa){var ba=o[y];if(ba&&ba.action_id==z){w(y);q[y]=aa;x.inform('dialog-fetched',y);}}});e.exports=x;});
__d("LiveBar",["ChatOrderedList","function-extensions","LegacyContextualDialog","ChatConfig","CSS","LiveBarData","copyProperties","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f){b('ChatOrderedList');b('function-extensions');b('LegacyContextualDialog');var g=b('ChatConfig'),h=b('CSS'),i=b('LiveBarData'),j=b('copyProperties'),k=b('setTimeoutAcrossTransitions'),l=b('shield'),m=g.get('livebar_fetch_defer')||1000;function n(o,p,q){this._orderedList=o;this._root=o.getRoot();this._liveBarTypes=q;this._hoverController=o.getHoverController();this._hoverController.subscribe('hover',this._mouseMove.bind(this));this._hoverController.subscribe('leave',this._mouseLeave.bind(this));o.subscribe('render',l(this._handleChatListUpdate,this));i.subscribe('new-actions',this._updateIcons.bind(this));i.subscribe('remove-action',this._handleRemoveAction.bind(this));i.subscribe('dialog-fetched',function(r,s){this._setDialogContent(s);}.bind(this));i.addActions(p);}j(n,{setDialog:function(o,p,q){i.setDialog(o,p,q);}});j(n.prototype,{_root:null,_liveBarTypes:null,_hoverController:null,_registrations:{},_renderedIcons:{},_fetchTimer:null,_mouseLeftRoot:false,_chatListRendered:false,_getLiveBarTypes:function(){return this._liveBarTypes;},_handleChatListUpdate:function(){if(!this._chatListRendered){this._chatListRendered=true;this._updateIcons();}},_handleShow:function(o){this._setDialogContent(o);},_mouseMove:function(){if(!this._fetchTimer){this._fetchTimer=k(this._fetch.bind(this),m);this._mouseLeftRoot=false;}},_mouseLeave:function(){this._mouseLeftRoot=true;clearTimeout(this._fetchTimer);this._fetchTimer=null;},_setDialogContent:function(o){var p=i.getDialog(o);if(p)this._hoverController.showHovercard(o,p);},_fetch:function(){if(this._mouseLeftRoot)return;this._fetchTimer=null;i.fetch();},_updateIcons:function(){if(!this._chatListRendered)return;var o=this._orderedList.getAllNodes(),p=this._getLiveBarTypes();for(var q in o){var r=i.getAction(q);if(r&&(!this._renderedIcons[q]||this._renderedIcons[q]!=r.action_id)){for(var s=0;s<p.length;s++)h.removeClass(o[q],p[s]);h.addClass(o[q],r.livebar_type);this._renderedIcons[q]=r.action_id;var t=this._hoverController.register(q,this._handleShow.bind(this));if(t)this._registrations[q]=t;}}},_handleRemoveAction:function(o,p){var q=p.action_id,r=p.actor_id;this._registrations[r]&&this._registrations[r].unregister();delete this._registrations[r];if(this._renderedIcons[r]==q){var s=this._getLiveBarTypes(),t=this._orderedList.getAllNodes();if(t[r])for(var u=0;u<s.length;u++)h.removeClass(t[r],s[u]);delete this._renderedIcons[r];}}});e.exports=n;});
__d("LiveBarDark",["Class","LiveBar","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Class'),h=b('LiveBar'),i=b('copyProperties'),j=b('emptyFunction');function k(l,m,n){this.parent.construct(this,l,m,n);}g.extend(k,h);i(k.prototype,{_setupDialogContent:j,_show:j,_updateIcons:j,_handleRemoveAction:j,_handleChatListUpdate:j});e.exports=k;});
__d("ChatSidebarDropdown",["Arbiter","AsyncRequest","Chat","ChatOptions","ChatVisibility","CSS","DOM","Event","JSLogger","PresenceState","SelectorDeprecated","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Chat'),j=b('ChatOptions'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('Event'),o=b('JSLogger'),p=b('PresenceState'),q=b('SelectorDeprecated'),r=b('copyProperties');function s(t,u){this._root=t;this._logger=o.create('blackbird');this._displayBrowserNotificationsIfNeeded();q.listen(t,'select',this._onSelect.bind(this));q.listen(t,'toggle',this._onToggle.bind(this));if(u){q.listen(t,'close',u.allowCollapse.curry(true,'SidebarMenu'));q.listen(t,'open',u.allowCollapse.curry(false,'SidebarMenu'));}g.subscribe('chat/option-changed',this._onOptionChanged.bind(this));}r(s,{registerEditFavorites:function(t,u,v){function w(x){l.conditionShow(t,!x);l.conditionShow(u,x);}n.listen(t,'click',function(){v.toggleEditMode();w(true);});n.listen(u,'click',function(){v.toggleEditMode();w(false);});v.subscribe('editStart',w.curry(true));v.subscribe('editEnd',w.curry(false));}});r(s.prototype,{changeSetting:function(t,u){if(this._pendingChange)return false;this._pendingChange=true;var v={};v[t]=u;j.setSetting(t,u,'sidebar_menu');new h('/ajax/chat/settings.php').setHandler(this._onChangeSettingResponse.bind(this,t,u)).setErrorHandler(this._onChangeSettingError.bind(this,t,u)).setFinallyHandler(this._onChangeFinally.bind(this)).setData(v).setAllowCrossPageTransition(true).send();},_displayBrowserNotificationsIfNeeded:function(){if(window.webkitNotifications){m.scry(document,'li.sidebar-browser-notif').forEach(l.show);if(window.webkitNotifications.checkPermission()!==0)m.scry(document,'li.sidebar-browser-notif').forEach(function(t){l.removeClass(t,'checked');});}},_conditionEnabled:function(t,u){var v=q.getOption(this._root,t);v&&q.setOptionEnabled(v,u);},_onChangeSettingResponse:function(t,u,v){p.doSync();},_onChangeSettingError:function(t,u,v){j.setSetting(t,!u,'sidebar_menu_error');},_onChangeFinally:function(){this._pendingChange=false;},_onOptionChanged:function(t,u){var v=u.name,w=u.value;if(v==='sound'||v==='browser_notif'){var x=q.getOption(this._root,v);if(w!==q.isOptionSelected(x))q.setSelected(this._root,v,w);}},_onSelect:function(t){if(this._pendingChange)return false;var u=false,v=false,w=q.getOptionValue(t.option);switch(w){case 'sidebar':return this.toggleSidebar();case 'online':if(!k.isOnline()){k.goOnline();}else v=true;u=true;break;case 'offline':if(k.isOnline()){k.goOffline();}else v=true;u=true;break;case 'advanced_settings':case 'turn_off_dialog':g.inform('chat/advanced-settings-dialog-opened');u=true;break;}if(v){this._logger.error('sidebar_dropdown_visibility_error',{action:w});}else this._logger.log('sidebar_dropdown_set_visibility',{action:w});if(u){q.toggle(this._root);return false;}},_onToggle:function(t){if(this._pendingChange)return false;var u=q.getOptionValue(t.option),v=q.isOptionSelected(t.option);switch(u){case 'visibility':if(!k){this._jslogger.error('on_toggle_visibility_undefined');return;}k.toggleVisibility();this._logger.log('sidebar_dropdown_toggle_visibility',{available:v});break;case 'browser_notif':if(v&&window.webkitNotifications&&window.webkitNotifications.checkPermission()!==0){window.webkitNotifications.requestPermission(function(){this.changeSetting(u,v);}.bind(this));}else this.changeSetting(u,v);break;case 'sound':this.changeSetting(u,v);break;}q.toggle(this._root);},_onVisibilityChanged:function(){var t=k.isOnline(),u=q.getOption(this._root,'visibility');if(t!==q.isOptionSelected(u))q.setSelected(this._root,'visibility',t);},toggleSidebar:function(){i.toggleSidebar();q.toggle(this._root);return false;}});e.exports=s;});
__d("ChatSidebarLog",["ModuleDependencies","JSLogger"],function(a,b,c,d,e,f){var g=b('ModuleDependencies'),h=b('JSLogger'),i=h.create('chat_sidebar_load'),j=null;try{d(['ChatSidebar'],function(n){j=n;});}catch(k){i.warn('exception',{reason:k.toString()});}function l(n){setTimeout(function(){var o=g.getMissing('ChatSidebar');if(!j)i.warn('require_'+n,{missing:o});if(j&&!j.isInitialized())i.warn('init_'+n,{missing:o});},n);}var m={start:function(){l(5000);l(10000);l(15000);l(30000);l(60000);}};e.exports=m;});
__d("NotificationConstants",[],function(a,b,c,d,e,f){e.exports={PayloadSourceType:{UNKNOWN:0,USER_ACTION:1,LIVE_SEND:2,ENDPOINT:3,INITIAL_LOAD:4}};});
__d("NotificationTokens",["Env"],function(a,b,c,d,e,f){var g=b('Env'),h={tokenizeIDs:function(i){return i.map(function(j){return g.user+':'+j;});},untokenizeIDs:function(i){return i.map(function(j){return j.split(':')[1];});}};e.exports=h;});
__d("NotificationImpressions",["AsyncSignal","NotificationTokens","URI"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h=b('NotificationTokens'),i=b('URI'),j='/ajax/notifications/impression.php';function k(l,m){var n={ref:m};h.untokenizeIDs(l).forEach(function(o,p){n['alert_ids['+p+']']=o;});new g(i(j).getQualifiedURI().toString(),n).send();}e.exports={log:k};});
__d("NotificationPhotoThumbnail",[],function(a,b,c,d,e,f){function g(i){return i.style=='photo'?i.media.image:null;}var h={getThumbnail:function(i,j){var k;if(i&&i.length){k=g(i[0]);if(k)return k;}if(j){var l=j.attachments;if(l&&l.length)return g(l[0]);}return null;}};e.exports=h;});
__d("NotificationUpdates",["Arbiter","ChannelConstants","JSLogger","NotificationConstants","NotificationTokens","LiveTimer","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('JSLogger'),j=b('NotificationConstants'),k=b('NotificationTokens'),l=b('LiveTimer'),m=b('copyProperties'),n=b('createObjectFrom'),o={},p={},q={},r={},s=[],t=0,u=i.create('notification_updates');function v(){if(t)return;var z=o,aa=p,ba=q,ca=r;o={};p={};q={};r={};if(Object.keys(z).length)x('notifications-updated',z);if(Object.keys(aa).length)x('seen-state-updated',aa);if(Object.keys(ba).length)x('read-state-updated',ba);if(Object.keys(ca).length)x('hidden-state-updated',ca);s.pop();}function w(){if(s.length)return s[s.length-1];return j.PayloadSourceType.UNKNOWN;}function x(event,z){y.inform(event,{updates:z,source:w()});}g.subscribe(h.getArbiterType('notification_json'),function(z,aa){var ba=Date.now(),ca=aa.obj.nodes;if(ca){ca.forEach(function(da){da.receivedTime=ba;});u.debug('notifications_received',ca);y.handleUpdate(j.PayloadSourceType.LIVE_SEND,{nodes:ca});}});g.subscribe(h.getArbiterType('notifications_seen'),function(z,aa){var ba=k.tokenizeIDs(aa.obj.alert_ids);y.handleUpdate(j.PayloadSourceType.LIVE_SEND,{seenState:n(ba)});});g.subscribe(h.getArbiterType('notifications_read'),function(z,aa){var ba=k.tokenizeIDs(aa.obj.alert_ids);y.handleUpdate(j.PayloadSourceType.LIVE_SEND,{readState:n(ba)});});var y=m(new g(),{handleUpdate:function(z,aa){if(aa.servertime)l.restart(aa.servertime);if(Object.keys(aa).length)this.synchronizeInforms(function(){s.push(z);var ba=m({payloadsource:w()},aa);this.inform('update-notifications',ba);this.inform('update-seen',ba);this.inform('update-read',ba);this.inform('update-hidden',ba);}.bind(this));},didUpdateNotifications:function(z){m(o,n(z));v();},didUpdateSeenState:function(z){m(p,n(z));v();},didUpdateReadState:function(z){m(q,n(z));v();},didUpdateHiddenState:function(z){m(r,n(z));v();},synchronizeInforms:function(z){t++;try{z();}catch(aa){throw aa;}finally{t--;v();}}});e.exports=y;});
__d("NotificationStore",["KeyedCallbackManager","NotificationConstants","NotificationUpdates","RangedCallbackManager","MercuryServerDispatcher"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('NotificationConstants'),i=b('NotificationUpdates'),j=b('RangedCallbackManager'),k=b('MercuryServerDispatcher'),l=new g(),m=new j(function(p){var q=l.getResource(p);return q.creation_time;},function(p,q){return q-p;}),n={};i.subscribe('update-notifications',function(p,q){if(!q.nodes||!q.nodes.length)return;var r,s=[],t={},u;q.nodes.forEach(function(v){r=v.alert_id;u=l.getResource(r);if(!u||u.creation_time<v.creation_time){s.push(r);t[r]=v;}});l.addResourcesAndExecute(t);m.addResources(s);if(q.page_info)n=q.page_info;i.didUpdateNotifications(s);});k.registerEndpoints({'/ajax/notifications/client/get.php':{mode:k.IMMEDIATE,handler:function(p){i.handleUpdate(h.PayloadSourceType.ENDPOINT,p);}}});var o={getNotifications:function(p,q){var r=m.executeOrEnqueue(0,p,function(v){var w=l.executeOrEnqueue(v,function(x){q(x);});}),s=m.getUnavailableResources(r);if(s.length){m.unsubscribe(r);if(!o.canFetchMore()){l.executeOrEnqueue(m.getAllResources(),q);return;}var t=Math.max.apply(null,s),u=t-m.getCurrentArraySize()+1;k.trySend('/ajax/notifications/client/get.php',{cursor:n.end_cursor,length:u});}},getAll:function(p){o.getNotifications(o.getCount(),p);},getCount:function(){return m.getCurrentArraySize();},canFetchMore:function(){if(n.hasOwnProperty('has_next_page'))return n.has_next_page;return true;}};e.exports=o;});
__d("NotificationUserActions",["AsyncRequest","AsyncSignal","NotificationConstants","NotificationStore","NotificationTokens","NotificationUpdates","URI","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AsyncSignal'),i=b('NotificationConstants'),j=b('NotificationStore'),k=b('NotificationTokens'),l=b('NotificationUpdates'),m=b('URI'),n=b('createObjectFrom'),o=b('emptyFunction'),p=i.PayloadSourceType.USER_ACTION,q='mark_spam',r='turn_off',s='undo',t='first_receipt_yes',u='first_receipt_no';function v(aa){var ba=m('/ajax/notifications/mark_read.php').getQualifiedURI().toString();new h(ba,aa).send();}function w(aa){var ba={};aa.forEach(function(ca,da){ba['alert_ids['+da+']']=ca;});return ba;}function x(aa,ba,ca,da){var ea=k.untokenizeIDs([aa])[0];new g('/ajax/notifications/negative_req.php').setData({notification_id:ea,client_rendered:true,request_type:ba}).setHandler(ca||o).setErrorHandler(da||o).send();}function y(aa,ba,ca,da,ea){var fa=ea?s:r;j.getAll(function(ga){var ha=Object.keys(ga).filter(function(ia){var ja=ga[ia];return !!(ja.application&&ja.application.id&&ja.application.id==ba);});x(aa,fa,function(ia){ca(ia);l.handleUpdate(p,{hiddenState:n(ha,!ea)});},da);});}var z={markNotificationsAsSeen:function(aa){l.handleUpdate(p,{seenState:n(aa)});var ba=k.untokenizeIDs(aa),ca=w(ba);ca.seen=true;v(ca);if(a.presenceNotifications)a.presenceNotifications.alertList.markSeen(ba);},markNotificationsAsRead:function(aa){l.handleUpdate(p,{readState:n(aa)});var ba=k.untokenizeIDs(aa);v(w(ba));if(a.presenceNotifications)a.presenceNotifications.markRead(false,ba);},markNotificationAsHidden:function(aa,ba,ca){l.handleUpdate(p,{hiddenState:n([aa])});x(aa,r,ba,ca);},markNotificationAsVisible:function(aa,ba,ca){l.handleUpdate(p,{hiddenState:n([aa],false)});x(aa,s,ba,ca);},markNotificationAsSpam:function(aa,ba,ca){l.handleUpdate(p,{hiddenState:n([aa],false)});x(aa,q,ba,ca);},markAppAsHidden:function(aa,ba,ca,da){var ea=false;y(aa,ba,ca,da,ea);},markAppAsVisible:function(aa,ba,ca,da){var ea=true;y(aa,ba,ca,da,ea);},markFirstReceiptYes:function(aa,ba,ca){x(aa,t,ba,ca);},markFirstReceiptNo:function(aa,ba,ca){x(aa,u,ba,ca);}};e.exports=z;});
__d("NotificationBeeperItem",["ReactDOM","Animation","BrowserSupport","CloseButton","ImageBlock","Layout","NotificationURI","NotificationUserActions","React","ReactTextWithEntities","Timestamp","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('ReactDOM'),h=b('Animation'),i=b('BrowserSupport'),j=b('CloseButton'),k=b('ImageBlock'),l=b('Layout'),m=b('NotificationURI'),n=b('NotificationUserActions'),o=b('React'),p=b('ReactTextWithEntities'),q=b('Timestamp'),r=b('cx'),s=b('setTimeoutAcrossTransitions');function t(v,w){return g.span({className:"fwb"},v);}var u=o.createClass({displayName:'NotificationBeeperItem',getInitialState:function(){return {hidden:false,fadedIn:false};},_markAsRead:function(){n.markNotificationsAsRead([this.props.beep.notificationID]);this.updateState({hidden:true});},_onClose:function(){this._markAsRead();this.updateState({hidden:true});},componentDidMount:function(){var v;if(i.hasCSSAnimations()){v=this.createStateUpdater({fadedIn:true});}else v=function(){new h(this.refs.item.getDOMNode()).from('top','-30px').from('opacity','0').to('top','0px').to('opacity','1').duration(200).ondone(this.createStateUpdater({fadedIn:true})).go();}.bind(this);s(v,50);this.props.onInserted(this.props.beep);},_doFlash:function(){new h(this.refs.inner.getDOMNode()).from('opacity','0').to('opacity','1').duration(200).go();},componentDidUpdate:function(v){if(v.beep.beepID!==this.props.beep.beepID)this._doFlash();},render:function(){var v=this.props.beep,w=(("_3sod")+(this.state.fadedIn?' '+"_3soe":'')+(this.state.hidden?' '+"_3sof":'')),x=v.icon.uri,y=v.link?m.localize(v.link):'#',z=v.photo&&m.snowliftable(y);return (g.li({className:w,ref:"item",'data-gt':v.tracking},g.div({ref:"inner"},[j({className:"_3soc",onClick:this._onClose.bind(this),size:l.size.medium}),g.a({href:y,ajaxify:z?y:null,onClick:this._markAsRead.bind(this),rel:z?'theater':null,className:"_3soi"},k({className:"_3soj"},[g.img({src:v.actors[0].profile_picture.uri,className:"_3sok"}),g.div({className:"_3sol"},[p({interpolator:t,ranges:v.text.ranges,aggregatedranges:v.text.aggregated_ranges,text:v.text.text}),k({className:"_3som"},[g.img({src:x}),q({time:v.timestamp.time,text:v.timestamp.text,verbose:v.timestamp.verbose})])])]))])));}});e.exports=u;});
__d("NotificationSound",["Sound","copyProperties"],function(a,b,c,d,e,f){var g=b('Sound'),h=b('copyProperties'),i=5000;g.init(['audio/mpeg']);function j(k){this._soundPath=k;this._lastPlayed=0;}h(j.prototype,{play:function(k){if(!this._soundPath)return;var l=Date.now();if((l-this._lastPlayed)<i)return;this._lastPlayed=l;g.play(this._soundPath,k);}});e.exports=j;});
__d("NotificationBeeper",["ReactDOM","Animation","Arbiter","ChannelConstants","NotificationBeeperItem","NotificationConstants","NotificationImpressions","NotificationPhotoThumbnail","NotificationSound","NotificationUpdates","NotificationUserActions","React","Style","cx","isEmpty","merge","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f){var g=b('ReactDOM'),h=b('Animation'),i=b('Arbiter'),j=b('ChannelConstants'),k=b('NotificationBeeperItem'),l=b('NotificationConstants'),m=b('NotificationImpressions'),n=b('NotificationPhotoThumbnail'),o=b('NotificationSound'),p=b('NotificationUpdates'),q=b('NotificationUserActions'),r=b('React'),s=b('Style'),t=b('cx'),u=b('isEmpty'),v=b('merge'),w=b('setTimeoutAcrossTransitions'),x=b('shield'),y=5000,z=2000,aa='beeper',ba=l.PayloadSourceType.LIVE_SEND,ca=r.createClass({displayName:'NotificationBeeper',getInitialState:function(){return {soundEnabled:this.props.soundEnabled,hovering:false,fading:false,paused:false,pendingBeeps:{},renderedBeeps:{}};},componentWillMount:function(){var ea=j.getArbiterType('notif_sound_pref_changed'),fa='update-notifications';this.subscriptions=[p.subscribe(fa,function(ga,ha){if(ha.payloadsource==ba){var ia=ha.nodes;if(ia&&ia.length)this._handleBeepChanges(da(ia));}}.bind(this)),i.subscribe(ea,function(ga,ha){this.updateState({soundEnabled:ha.obj.enabled});}.bind(this))];},componentWillUnmount:function(){this.subscriptions.forEach(function(ea){ea.unsubscribe();});this.subscriptions=null;},_onMouseEnter:function(){if(this.state.paused)return;this._hideWait&&clearTimeout(this._hideWait);if(this.state.fading){this._animation.stop();this._animation=null;s.set(this.refs.container.getDOMNode(),'opacity','0.96');}var ea=Object.keys(this.state.renderedBeeps);if(this.props.unseenVsUnread){q.markNotificationsAsSeen(ea);}else q.markNotificationsAsRead(ea);this.updateState({hovering:true,fading:false,pendingBeeps:{},renderedBeeps:v(this.state.renderedBeeps,this.state.pendingBeeps)});},_onMouseLeave:function(){if(this.state.paused)return;this._waitToHide(z);this.updateState({hovering:false});},_onInsertedItem:function(ea){if(!this.state.hovering)this._waitToHide();if(this.state.soundEnabled&&ea.sound){if(!this._notifSound)this._notifSound=new o(this.props.soundPath);this._notifSound.play(ea.beepID);}if(this.props.shouldLogImpressions)m.log([ea.notificationID],aa);},_waitToHide:function(ea){this._hideWait&&clearTimeout(this._hideWait);this._hideWait=w(x(this._hide,this),ea||y);},_hide:function(){this._animation&&this._animation.stop();this._animation=new h(this.refs.container.getDOMNode()).from('opacity','0.96').to('opacity','0').duration(1500).ondone(this._finishHide.bind(this)).go();this.updateState({fading:true});},_finishHide:function(){var ea=this.state.pendingBeeps;this.updateState({fading:false,pendingBeeps:{},renderedBeeps:{}});w(this.createStateUpdater({renderedBeeps:ea}));s.set(this.refs.container.getDOMNode(),'opacity','0.96');},_handleBeepChanges:function(ea){var fa=this.state.fading?this.state.pendingBeeps:this.state.renderedBeeps;Object.keys(ea).reverse().forEach(function(ga){var ha=ea[ga],ia=ha.beepID,ja=this.state.renderedBeeps[ga]||{};if(ja.beepID!=ia){delete fa[ga];fa[ga]=ha;}}.bind(this));if(!this.state.paused)this._waitToHide();this.updateState({});},_togglePause:function(){if(!this.state.paused){this._animation&&this._animation.stop();this._hideWait&&clearTimeout(this._hideWait);}else this._waitToHide();this.updateState({paused:!this.state.paused});},render:function(){var ea=this.state.renderedBeeps,fa={};Object.keys(ea).reverse().forEach(function(ja){var ka=ea[ja];fa[ja]=k({beep:ka,onInserted:this._onInsertedItem.bind(this)});},this);var ga=!u(fa),ha=null;if(ga&&this.props.canPause)ha=g.li({className:"_a_g",onClick:this._togglePause.bind(this)},this.state.paused?'Continue':'Pause [fb]');var ia=((!ga?"hidden_elem":'')+(' '+"_50d1"));return (g.ul({ref:"container",className:ia,'data-gt':this.props.tracking,onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this)},[fa,ha]));}});function da(ea){var fa={};ea.forEach(function(ga){var ha=ga.alert_id,ia=ha+'-'+ga.receivedTime,ja=n.getThumbnail(ga.attachments,ga.attached_story);fa[ha]={notificationID:ha,beepID:ia,actors:ga.actors,icon:ga.icon,link:ga.url,photo:ja,text:ga.unaggregatedTitle||ga.title,timestamp:ga.timestamp,receivedTime:ga.receivedTime,sound:!!ga.sound,tracking:ga.tracking};});return fa;}e.exports=ca;});
__d("FbdEventLog",["URI","AsyncSignal"],function(a,b,c,d,e,f){var g=b('URI'),h=b('AsyncSignal'),i={log:function(j,k,l,m){if(!j)return;var n=g('/desktop/eventlog.php'),o=new h(n.toString(),{event:j,category:k||'unknown',payload:l||''});o.setHandler(m).send();}};e.exports=i;});
__d("DownloadDialog",["Event","Arbiter","Class","DataStore","ModalMask","Overlay","Parent","Style","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('Class'),j=b('DataStore'),k=b('ModalMask'),l=b('Overlay'),m=b('Parent'),n=b('Style'),o=b('copyProperties'),p=b('emptyFunction');function q(){this.parent.construct(this);return this;}i.extend(q,l);o(q,{POSITIONS:{BOTTOM_LEFT:'bottom_left',TOP_LEFT:'top_left',IE9_BOTTOM:'ie9_bottom'},activeDialogs:{},dismissAll:function(){for(var r in this.POSITIONS)this.hideDialog(this.POSITIONS[r]);},hideDialog:function(r){var s=this.activeDialogs[r];s&&s.hide();this.activeDialogs[r]=null;}});o(q.prototype,{_cancelHandler:p,_closeHandler:p,_width:null,position:q.POSITIONS.BOTTOM_LEFT,init:function(r,s){this.parent.init(r);this.position=s;var t=(j.get(this._root,'modal')==='true');q.hideDialog(s);q.activeDialogs[s]=this;g.listen(this._root,'click',function(event){if(m.byClass(event.getTarget(),'closeButton'))if(this._cancelHandler()!==false)q.hideDialog(this.position);}.bind(this));this.subscribe('show',function(){if(t)k.show();h.inform('layer_shown',{type:'DownloadDialog'});}.bind(this));this.subscribe('hide',function(){if(t)k.hide();h.inform('layer_hidden',{type:'DownloadDialog'});this._closeHandler();}.bind(this));},setWidth:function(r){this._width=Math.floor(r);return this;},updatePosition:function(){if(this._width)n.set(this._overlay,'width',this._width+'px');return true;},setCancelHandler:function(r){this._cancelHandler=r||p;return this;},setCloseHandler:function(r){this._closeHandler=r||p;return this;}});e.exports=q;a.DownloadDialog=q;});
__d("FbdConversionTracking",["AsyncRequest","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('emptyFunction'),i={logClick:function(j,k){if(!k)k='desktop';new g().setURI('/ajax/desktop/log_clicks.php').setData({click_source:j,promo:k}).setAllowCrossPageTransition(true).setErrorHandler(h).send();},logConversion:function(j,k){if(!k)k='desktop';new g().setURI('/ajax/desktop/log_conversions.php').setData({conversion_action:j,promo:k}).setAllowCrossPageTransition(true).setErrorHandler(h).send();}};e.exports=i;});
__d("MegaphoneHelper",["Animation","AsyncRequest","Dialog","ge"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('AsyncRequest'),i=b('Dialog'),j=b('ge'),k={hideStory:function(l,m,n,o,p){var q={mp_id:l,location:m,context:o};new h().setURI('/ajax/megaphone/megaphone_hide.php').setMethod('POST').setData(q).setHandler(function(s){p&&p(s);}).send();var r=j(n);if(r)new g(r).to('height',0).duration(500).hide().go();},createModalStory:function(l,m,n,o){var p;if(!l.buttons||!l.buttons.length){l.buttons=i.CLOSE;p=this.hideStory.bind(this,m,n,o,null);}var q=new i(l);if(p)q.setHandler(p);q.show();},buttonOnClick:function(l,m,n,o,p,q){var r=function(){if(p){new h().setURI(o).send();}else document.location.href=o;};if(q){this.hideStory(l,m,'',n,function(){r();});}else r();}};e.exports=k;});
__d("FbdInstall",["$","AsyncRequest","CSS","DOM","DownloadDialog","FbdConversionTracking","FbdEventLog","FBDesktopDetect","FBDesktopPlugin","MegaphoneHelper"],function(a,b,c,d,e,f){var g=b('$'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('DownloadDialog'),l=b('FbdConversionTracking'),m=b('FbdEventLog'),n=b('FBDesktopDetect'),o=b('FBDesktopPlugin'),p=b('MegaphoneHelper'),q=1000,r=300*q,s={cancelSetup:function(){var t=JSON.stringify({ref:this.ref});m.log('download_canceled','setup',t);l.logConversion('download_canceled');},hideMegaphone:function(){if(this.megaphoneId&&this.megaphoneLoc)p.hideStory(this.megaphoneId,this.megaphoneLoc,this.elementId,'',null);},init:function(t,u){this.downloadUrl=t;this.ref=u||'unknown';},initInstallWait:function(t,u,v){this.megaphoneId=t;this.megaphoneLoc=u;this.elementId=v;this._waitForInstall(r);},promptDownload:function(t){t=t||this.downloadUrl;if(t){var u=JSON.stringify({ref:this.ref});m.log('download_prompted','setup',u);l.logConversion('download_prompted');var v=j.create('iframe',{src:t,className:'hidden_elem'});j.appendContent(document.body,v);}},_responseHandler:function(t){if(t.payload){this._authToken=t.payload.access_token;this._userId=t.payload.id;}if(this._authToken&&this._userId){this._waitForRunningStart=Date.now();setTimeout(this._waitForRunning.bind(this),q);}},setupPlugin:function(){new h('/ajax/desktop/download').send();this.promptDownload();},updateSidebarLinkVisibility:function(){if(!n.isPluginInstalled()){i.show(g('sidebar-messenger-install-link'));i.show(g('sidebar-messenger-install-separator'));}},_waitForInstall:function(t){var u=JSON.stringify({ref:this.ref});if(n.isPluginInstalled()){m.log('install_success','setup',u);l.logConversion('install_success');o.recheck();new h("/desktop/fbdesktop2/transfer.php").setMethod("POST").setHandler(this._responseHandler.bind(this)).send();k.dismissAll();this.hideMegaphone();return;}if(t<=0){m.log('install_timeout','setup',u);l.logConversion('install_timeout');k.dismissAll();}else setTimeout(this._waitForInstall.bind(this,t-q),q);},_waitForRunning:function(){var t=Date.now()-this._waitForRunningStart;if(o.isAppRunning()){o.transferAuthToken(this._authToken,this._userId);}else if(t<r)setTimeout(this._waitForRunning.bind(this),q);}};e.exports=s;});
__d("legacy:fbdesktop2-install-js",["FbdInstall"],function(a,b,c,d){a.FbdInstall=b('FbdInstall');},3);
__d("legacy:fbdesktop-conversion-tracking",["FbdConversionTracking"],function(a,b,c,d){a.FbdConversionTracking=b('FbdConversionTracking');},3);
__d("SidebarTicker",["Arbiter","ChatSidebar","CSS","DOM","Run","TickerController","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatSidebar'),i=b('CSS'),j=b('DOM'),k=b('Run'),l=b('TickerController'),m=b('$'),n=b('copyProperties');function o(){this._ticker=m('pagelet_ticker');this._initSubscriptions();if(i.hasClass(document.documentElement,'sidebarMode'))this._onSidebarShow();}o.hide=function(){k.onAfterLoad(function(){j.remove(m('pagelet_ticker'));j.remove(j.find(document.body,'div.fbSidebarGripper'));h.resize();});};n(o.prototype,{_initSubscriptions:function(){this._subscriptions=[g.subscribe('sidebar/show',this._onSidebarShow.bind(this))];},_onSidebarShow:function(){l.show(this._ticker);}});e.exports=o;});
__d("SidebarTickerResizer",["Arbiter","AsyncRequest","ChatSidebar","SimpleDrag","$"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChatSidebar'),j=b('SimpleDrag'),k=b('$'),l=1e-07;function m(n){var o=k('pagelet_ticker'),p=o.parentNode,q=this._saveResizedState.bind(this),r,s,t,u=function(x,event){r=event.clientY;s=o.offsetHeight;t=p.offsetHeight;},v=function(x,event){var y=s+(event.clientY-r),z=100-(((t-y)/t)*100);z=Math.max(l,Math.min(90,z));o.style.height=z+'%';if(x=='end'){q(z);g.inform('Ticker/resized');}i.resize();},w=new j(n);w.subscribe('start',u);w.subscribe(['update','end'],v);}m.prototype._saveResizedState=function(n){new h('/ajax/feed/ticker/resize').setData({height:''+n}).setMethod('POST').send();};e.exports=m;});
__d("legacy:megaphone",["MegaphoneHelper"],function(a,b,c,d){a.MegaphoneHelper=b('MegaphoneHelper');},3);
__d("NotificationXOut",["Arbiter","Event","userAction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Event'),i=b('userAction');function j(p,q,r){g.inform('notif/negativeCancel',{id:p});k(q,r);h.$E(r).kill();}function k(p,q){i('click',null,q,null,{gt:p});}function l(p,q){k(p,q);h.$E(q).prevent();}function m(p,q){h.listen(p,'click',k.curry(q));}function n(p,q,r){h.listen(p,'click',j.curry(q,r));}function o(p,q){h.listen(p,'click',l.curry(q));}e.exports={setupConfirmListener:m,setupCancelListener:n,setupNoListener:o};});
__d("LiveMessageReceiver",["Arbiter","ChannelConstants","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('copyProperties'),j=b('emptyFunction'),k=b('shield');function l(m){this.eventName=m;this.subs=null;this.handler=j;this.shutdownHandler=null;this.registered=false;this.appId=1;}i(l,{getAppMessageType:function(m,n){return 'live_message/'+m+':'+n;},route:function(m){var n=function(o){var p=l.getAppMessageType(m.app_id,m.event_name);g.inform(p,o,g.BEHAVIOR_PERSISTENT);};n(m.response);}});i(l.prototype,{setAppId:function(m){this.appId=m;return this;},setHandler:function(m){this.handler=m;this._dirty();return this;},setRestartHandler:j,setShutdownHandler:function(m){this.shutdownHandler=k(m);this._dirty();return this;},_dirty:function(){if(this.registered){this.unregister();this.register();}},register:function(){var m=function(o,p){return this.handler(p);}.bind(this),n=l.getAppMessageType(this.appId,this.eventName);this.subs={};this.subs.main=g.subscribe(n,m);if(this.shutdownHandler)this.subs.shut=g.subscribe(h.ON_SHUTDOWN,this.shutdownHandler);this.registered=true;return this;},unregister:function(){if(!this.subs)return this;for(var m in this.subs)if(this.subs[m])this.subs[m].unsubscribe();this.subs=null;this.registered=false;return this;}});e.exports=l;});
__d("initLiveMessageReceiver",["Arbiter","ChannelConstants","LiveMessageReceiver"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('LiveMessageReceiver');g.subscribe(h.getArbiterType('app_msg'),function(j,k){i.route(k.obj);});});
__d("InnerStickyArea",["Event","ContextualLayer","CSS","DataStore","DOM","LayerHideOnTransition","Locale","Parent","Style","Vector","copyProperties","cx","removeFromArray"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ContextualLayer'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('LayerHideOnTransition'),m=b('Locale'),n=b('Parent'),o=b('Style'),p=b('Vector'),q=b('copyProperties'),r=b('cx'),s=b('removeFromArray');function t(w){var x=n.byClass(w,'scrollable')||o.getScrollParent(w.parentNode);return x;}function u(w){var x=t(w);this.node=w;this._extracted=false;this._placeholder=k.create('div',{className:"_ptr"});v.getInstance(x).register(this);}q(u.prototype,{update:function(){if(this._extracted){p.getElementDimensions(this._placeholder).setElementWidth(this.node);p.getElementDimensions(this.node).setElementHeight(this._placeholder);}else p.getElementDimensions(this.node).setElementWidth(this.node).setElementHeight(this._placeholder);return this;},setExtracted:function(w){if(w===this._extracted)return this;if(w){this.update();k.replace(this.node,this._placeholder);}else{o.set(this.node,'height',null);o.set(this.node,'width',null);if(this._placeholder.parentNode){k.replace(this._placeholder,this.node);}else k.remove(this.node);}this._extracted=w;return this;},getInlineNode:function(){return this._extracted?this._placeholder:this.node;},isDisplayed:function(){var w=this.getInlineNode();return w.offsetWidth>0&&w.offsetHeight>0;},getStickyContainer:function(){return this._stickyContainer;},updateContainer:function(){var w=t(this.node);v.getInstance(w).register(this);}});function v(w){this.node=w;this._areas=[];this._fixTarget=null;this._fixedArea=null;this._initialized=false;this._layer=new h({permanent:true},k.create('div')).setInsertParent(this.node.parentNode).disableBehavior(l);this._listener=g.listen(w,'scroll',this.update.bind(this));i.addClass(w,"_pts");j.set(w,'StickyContainer',this);}v.getInstance=function(w){var x=j.get(w,'StickyContainer');return x||new v(w);};u.getStickyContainer=function(w){return v.getInstance(t(w));};q(v.prototype,{isDisplayed:function(){return this.node.offsetWidth>0&&this.node.offsetHeight>0;},register:function(w){if(w.getStickyContainer())w.getStickyContainer().unregister(w);w._stickyContainer=this;this._areas.push(w);this.update();return this;},unregister:function(w){s(this._areas,w);this.update();},update:function(){if(!this.isDisplayed())return this;var w=null,x=this,y=this.node.scrollTop,z;for(var aa=0;aa<this._areas.length;aa++){var ba=this._areas[aa],ca=ba.getInlineNode();if(!ba.isDisplayed())continue;if(!k.contains(this.node.parentNode,ca))continue;var da=ca.offsetTop;if(da<=y){if(z===undefined||da>z){w=ba;z=da;}}else if(w){var ea=p.getElementDimensions(w.node).y;if(da-ea<y)x=ba;break;}}if(this._fixedArea===w&&this._fixTarget===x){this._fixedArea&&this._fixedArea.update();}else{if(this._fixedArea&&this._fixedArea!==w)this._unfixArea(this._fixedArea);if(w)this._fixAreaTo(w,x);this._fixedArea=w;this._fixTarget=x;}return this;},destroy:function(){this._listener&&this._listener.remove();this._listener=null;},_fixAreaTo:function(w,x){this._layer.hide();w.setExtracted(true);if(x instanceof v){this._layer.setInsertParent(this.node.parentNode).setAlignment(m.isRTL()?'right':'left').setContext(this.node);}else this._layer.setInsertParent(this.node).setContext(x.node);this._layer.setContent(w.node).show();},_unfixArea:function(w){this._layer.hide();w.setExtracted(false);}});e.exports=u;});